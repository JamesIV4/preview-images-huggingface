<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HiDream‑I1 Artists – Responsive Lazy Gallery + Zoom</title>

    <style>
      /* ─────────── variables & responsiveness ─────────── */
      :root {
        --cols: 4;
      } /* desktop default */
      @media (max-width: 700px) {
        :root {
          --cols: 2;
        }
      } /* phone default */

      /* ─────────── basic layout ─────────── */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: Arial, Helvetica, sans-serif;
        background: #f6f6f6;
        padding: 24px;
      }
      h1 {
        text-align: center;
        font-weight: 600;
        margin-bottom: 12px;
      }

      /* A‑Z jump bar */
      #az {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 16px;
        font-size: 15px;
        font-weight: 600;
      }
      #az a,
      #az span {
        padding: 4px 6px;
        border-radius: 4px;
        user-select: none;
      }
      #az a {
        color: #0366d6;
        text-decoration: none;
        border: 1px solid #0366d6;
      }
      #az a:hover {
        background: #0366d6;
        color: #fff;
      }
      #az span {
        color: #aaa;
        border: 1px solid #ddd;
        cursor: not-allowed;
      }

      /* status */
      #status {
        font-size: 18px;
        text-align: center;
        margin-top: 40px;
        color: #444;
      }

      /* ─────────── gallery grid ─────────── */
      #gallery {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(var(--cols), 1fr);
      }
      figure {
        margin: 0;
        background: #fff;
        border: 1px solid #ddd;
        padding: 12px;
        text-align: center;
      }
      img {
        display: block;
        width: 100%;
        height: auto;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }
      img.lazy {
        background: #e0e0e0;
        aspect-ratio: 1/1;
        filter: blur(4px);
        transition: filter 0.3s;
      }
      figcaption {
        font-size: 14px;
        color: #555;
        margin-top: 6px;
        word-break: break-word;
      }
      .anchor {
        grid-column: 1/-1;
        height: 0;
        width: 0;
      }

      /* ─────────── fixed controls ─────────── */
      #zoomControls {
        position: fixed;
        left: 16px;
        bottom: 16px;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      #zoomControls button {
        background: #0366d6;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 14px;
        font-size: 18px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        cursor: pointer;
      }
      #zoomControls button:hover {
        background: #024ea4;
      }

      #toTop {
        position: fixed;
        right: 16px;
        bottom: 16px;
        z-index: 999;
        background: #0366d6;
        color: #fff;
        text-decoration: none;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
      #toTop:hover {
        background: #024ea4;
      }
    </style>
  </head>
  <body>
    <h1 id="top">HiDream‑I1 Artists – Image Repository</h1>

    <nav id="az">A‑Z loading…</nav>

    <div id="status">Fetching image list…</div>

    <div id="gallery"></div>

    <!-- zoom buttons -->
    <div id="zoomControls">
      <button id="zoomIn" aria-label="Zoom in (bigger images)">＋</button>
      <button id="zoomOut" aria-label="Zoom out (smaller images)">−</button>
    </div>

    <!-- Back‑to‑top link -->
    <a href="#top" id="toTop">Back to top</a>

    <script>
      (async () => {
        const repo = "newsletter/HiDream-I1-Artists";
        const info = `https://huggingface.co/api/datasets/${repo}?expand=siblings`;
        const tree = `https://huggingface.co/api/datasets/${repo}/tree/main?recursive=true`;
        const raw = (f) =>
          `https://huggingface.co/datasets/${repo}/resolve/main/${f
            .split("/")
            .map(encodeURIComponent)
            .join("/")}`;

        /* ---------- fetch image list ---------- */
        async function list(url) {
          const r = await fetch(url);
          if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);
          const j = await r.json();
          const arr = Array.isArray(j) ? j : j.siblings || [];
          return arr
            .map((x) => x.rfilename || x.path || x)
            .filter((n) => /\.(png|jpe?g|gif|webp)$/i.test(n));
        }

        const az = document.getElementById("az");
        const grid = document.getElementById("gallery");

        function buildAZ(set) {
          az.innerHTML = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ"]
            .map((L) =>
              set.has(L) ? `<a href="#${L}">${L}</a>` : `<span>${L}</span>`
            )
            .join("");
        }

        function addCard(file) {
          const fig = document.createElement("figure");
          fig.innerHTML = `
      <img class="lazy" data-src="${raw(file)}" alt="${file}" loading="lazy"
           src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==">
      <figcaption>${file}</figcaption>`;
          grid.appendChild(fig);
        }

        try {
          let files;
          try {
            files = await list(info);
          } catch {
            files = await list(tree);
          }

          files.sort((a, b) => a.localeCompare(b, "en", { numeric: true }));
          buildAZ(new Set(files.map((f) => f[0].toUpperCase())));

          let cur = "";
          files.forEach((f) => {
            const first = f[0].toUpperCase();
            if (first !== cur) {
              cur = first;
              const anchor = document.createElement("div");
              anchor.className = "anchor";
              anchor.id = cur;
              grid.appendChild(anchor);
            }
            addCard(f);
          });

          document.getElementById("status").remove();

          /* ---------- lazy‑loader ---------- */
          const io = new IntersectionObserver(
            (entries, obs) => {
              entries.forEach((e) => {
                if (e.isIntersecting) {
                  const img = e.target;
                  img.src = img.dataset.src;
                  img.classList.remove("lazy");
                  obs.unobserve(img);
                }
              });
            },
            { rootMargin: "200px" }
          );
          document
            .querySelectorAll("img.lazy")
            .forEach((img) => io.observe(img));
        } catch (err) {
          document.getElementById("status").textContent =
            "❌ Failed: " + err.message;
          console.error(err);
        }

        /* ---------- zoom controls (behavior swapped) ---------- */
        const root = document.documentElement;
        const MIN = 1,
          MAX = 10;
        const getCols = () =>
          parseInt(getComputedStyle(root).getPropertyValue("--cols")) || 4;
        const setCols = (n) => root.style.setProperty("--cols", n);

        // “＋”  → zoom IN  (fewer columns, larger images)
        document.getElementById("zoomIn").onclick = () => {
          const c = getCols();
          if (c > MIN) setCols(c - 1);
        };

        // “−”  → zoom OUT (more columns, smaller images)
        document.getElementById("zoomOut").onclick = () => {
          const c = getCols();
          if (c < MAX) setCols(c + 1);
        };
      })();
    </script>
  </body>
</html>
